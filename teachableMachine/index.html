<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‹°ì²˜ë¸”ë¨¸ì‹  ì´ë¯¸ì§€ ì¸ì‹ - ë§ˆì´í¬ë¡œë¹„íŠ¸/ESP32 ì—°ë™</title>
    <link rel="icon" type="image/png" sizes="32x32" href="../static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../static/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../static/favicon/favicon-16x16.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="https://unpkg.com/ml5@0.6.1/dist/ml5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/makeabilitylab/p5js/_libraries/serial.js"></script>
    <link rel="stylesheet" href="../common/header.css">
    <link rel="stylesheet" href="../common/template.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
</head>

<body class="serial-connection">
    <div class="header">
        <a href="../index.html" class="back-btn" title="ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°">&lt; ë©”ì¸í™”ë©´</a>
        <div class="header-content">
            <!-- ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ -->
            <button id="headerToggleBtn" class="btn-small header-toggle-btn" title="ì„¤ì • ì ‘ê¸°/í¼ì¹˜ê¸°"></button>
            <div class="desktop-only">
                <!-- ê¸°ì¡´ í—¤ë” íƒ€ì´í‹€/ì„¤ëª… -->
                <div class="header-title-desc">
                  <h1 id="headerTitle">ë§ˆì´í¬ë¡œë¹„íŠ¸ì™€ í‹°ì²˜ë¸”ë¨¸ì‹  ì—°ë™í•˜ê¸°</h1>
                  <p>ì›¹ìº ì„ í†µí•œ ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ì¸ì‹ìœ¼ë¡œ ë§ˆì´í¬ë¡œë¹„íŠ¸/esp32 ì œì–´</p>
                </div>
                <div class="header-settings-bar">
                    <!-- 1. MCU í† ê¸€ + ì—ë””í„° ë²„íŠ¼ (ì™¼ìª½) -->
                  <div class="header-settings-col header-settings-left">
                    <div class="settings-title">ë””ë°”ì´ìŠ¤ ì„ íƒ</div>
                    <div class="toggle-container">
                      <span class="toggle-label">ë§ˆì´í¬ë¡œë¹„íŠ¸</span>
                      <div class="toggle-switch" id="deviceToggle">
                        <div class="toggle-slider"></div>
                      </div>
                      <span class="toggle-label">ESP32</span>
                    </div>
                    <button id="editorButton" class="btn" onclick="window.open('https://makecode.microbit.org/#editor', '_blank')">
                      ë§ˆì´í¬ë¡œë¹„íŠ¸ ì—ë””í„° ì—´ê¸°
                    </button>
                  </div>
                  <!-- 2. ëª¨ë¸ URL ì…ë ¥ (ê°€ìš´ë°) -->
                  <div class="header-settings-col header-settings-center">
                    <div class="settings-title">í‹°ì²˜ë¸”ë¨¸ì‹  URL</div>
                    <form id="modelUrlForm" onsubmit="event.preventDefault(); document.getElementById('loadModelBtn').click();">
                      <input type="text" id="modelUrlInput" class="form-input"
                             placeholder="https://teachablemachine.withgoogle.com/models/xxxxxx/">
                      <button id="loadModelBtn" class="btn">ëª¨ë¸ ë¡œë“œ</button>
                    </form>
                  </div>
                  <!-- 3. ì‹œë¦¬ì–¼ ì—°ê²° (ì˜¤ë¥¸ìª½) -->
                  <div class="header-settings-col header-settings-right">
                    <div class="settings-title">ì‹œë¦¬ì–¼ í†µì‹  ì—°ê²°</div>
                    <p class="serial-notice">ì—°ê²°ì´ ëŠê¸°ê±°ë‚˜ ëª¨ë¸ì´ ë°”ë€Œë©´ ë‹¤ì‹œ ì—°ê²°í•˜ì„¸ìš”.</p>
                    <button id="serialButton" class="btn">ì‹œë¦¬ì–¼í†µì‹  ì—°ê²°</button>
                  </div>
                </div>
            </div>
        </div>
      </div>
    </div>

    <div class="container">
        <div class="main-section">
            <!-- ëª¨ë°”ì¼ ê²½ê³  ë©”ì‹œì§€ -->
            <div class="mobile-warning">
                <div class="warning-content">
                    <h3>ğŸ“± ëª¨ë°”ì¼ í™˜ê²½ ì•ˆë‚´</h3>
                    <p>ì‹œë¦¬ì–¼ í†µì‹ ì„ í†µí•œ MCU ì—°ê²°ì€ ë°ìŠ¤í¬í†± í™˜ê²½ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.<br>
                    ì»´í“¨í„°ë¡œ ì ‘ì†í•´ ì£¼ì„¸ìš”.</p>
                </div>
            </div>

            <!-- í‹°ì²˜ë¸”ë¨¸ì‹  ëª¨ë¸ ì„¤ì • -->
            

            <div class="content-section desktop-only">
                <div class="video-section">
                    <div class="video-container">
                      <div class="canvas-wrapper" id="canvasContainer">
                        <!-- p5.js canvas will be inserted here -->
                      </div>
                      <div class="video-title">ì‹¤ì‹œê°„ ì¹´ë©”ë¼</div>
                    </div>

                    <div class="status-panel">
                        <div class="video-title">ìƒíƒœ ì •ë³´</div>
                        <div class="status-item">
                            <span class="status-label">ëª¨ë¸ ìƒíƒœ:</span>
                            <span id="modelStatus" class="status-value status-waiting">ëŒ€ê¸°ì¤‘</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ì‹œë¦¬ì–¼ ì—°ê²°:</span>
                            <span id="serialStatus" class="status-value status-disconnected">ì—°ê²° ì•ˆë¨</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">í˜„ì¬ ë””ë°”ì´ìŠ¤:</span>
                            <span id="currentDevice" class="status-value status-ready">ë§ˆì´í¬ë¡œë¹„íŠ¸</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ì¸ì‹ ê²°ê³¼:</span>
                            <span id="recognitionResult" class="status-value status-waiting">-</span>
                        </div>
                    </div>
                </div>

                <div class="instructions">
                    <h3>ğŸ“‹ ì‚¬ìš© ë°©ë²•</h3>
                    <div id="instructionsContent">
                        <!-- Instructions will be rendered here by JavaScript -->
                    </div>
                </div>

                <div id="codeExamples" class="code-contents hidden">
                    <h3>ğŸ“‹ ì‚¬ìš© ë°©ë²•</h3>
                    <div class="code-examples">
                        <div class="example-tabs">
                            <button class="example-tab active" data-example="basic">ê¸°ë³¸ ì˜ˆì‹œ</button>
                            <button class="example-tab" data-example="advanced">ìŠ¤ë§ˆíŠ¸í™ˆPlus í‚¤íŠ¸ ëª¨í„° ì œì–´ ì˜ˆì‹œ</button>
                            <button class="example-tab" data-example="custom">íŒŒì´íŒŒì´í‚¤íŠ¸ ë„¤ì˜¤í”½ì…€ ì œì–´ ì˜ˆì‹œ</button>
                        </div>
                        <div class="example-content">
                            <pre class="line-numbers"><code class="language-python">
                                </code></pre>
                            <button class="copy-btn">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let isESP32Mode = false;

        const headerSettingsBar = document.querySelector('.header-settings-bar');
        const headerToggleBtn = document.getElementById('headerToggleBtn');
        if(headerToggleBtn && headerSettingsBar) {
            headerToggleBtn.addEventListener('click', () => {
                const isClosed = headerSettingsBar.classList.toggle('closed');
                headerToggleBtn.classList.toggle('closed');
                
                // ì»¨í…Œì´ë„ˆì˜ padding-top ê°’ì„ ë™ì ìœ¼ë¡œ ë³€ê²½
                const container = document.querySelector('.serial-connection .container');
                if (container) {
                    container.style.paddingTop = isClosed ? '180px' : '360px';
                }
            });
        }
        
        // DOM ìš”ì†Œë“¤
        const deviceToggle = document.getElementById('deviceToggle');
        const editorButton = document.getElementById('editorButton');
        const currentDeviceSpan = document.getElementById('currentDevice');
        const modelUrlInput = document.getElementById('modelUrlInput');
        const loadModelBtn = document.getElementById('loadModelBtn');
        const serialButton = document.getElementById('serialButton');
        const headerTitle = document.getElementById('headerTitle');
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        window.updateModelStatus = function(status, className = 'status-waiting') {
            const element = document.getElementById('modelStatus');
            if (element) {
                element.textContent = status;
                element.className = 'status-value ' + className;
            }
        };
        
        window.updateSerialStatus = function(status, className = 'status-disconnected') {
            const element = document.getElementById('serialStatus');
            if (element) {
                element.textContent = status;
                element.className = 'status-value ' + className;
            }
        };
        
        window.updateRecognitionResult = function(result) {
            const element = document.getElementById('recognitionResult');
            if (element) {
                element.textContent = result;
                element.className = 'status-value status-ready';
            }
        };

        // í—¤ë” ì œëª© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateHeaderTitle(isESP32) {
            const deviceName = isESP32 ? 'ESP32' : 'ë§ˆì´í¬ë¡œë¹„íŠ¸';
            headerTitle.textContent = `${deviceName}ì™€ í‹°ì²˜ë¸”ë¨¸ì‹  ì—°ë™í•˜ê¸°`;
        }

        // ë””ë°”ì´ìŠ¤ í† ê¸€ ì´ë²¤íŠ¸
        // Function to render instructions based on current device
        function renderInstructions(isESP32) {
            const instructions = isESP32 ? [
                'í—¤ë”ì—ì„œ ì‚¬ìš©í•  ë””ë°”ì´ìŠ¤(ë§ˆì´í¬ë¡œë¹„íŠ¸ ë˜ëŠ” ESP32)ë¥¼ ì„ íƒí•˜ì„¸ìš”',
                'í‹°ì²˜ë¸”ë¨¸ì‹ ì—ì„œ í•™ìŠµí•œ ëª¨ë¸ì˜ URLì„ ì…ë ¥í•˜ê³  "ëª¨ë¸ ë¡œë“œ"ë¥¼ í´ë¦­í•˜ì„¸ìš”',
                'Thonnyì—ì„œ ESP32ìš© ì‹œë¦¬ì–¼ í†µì‹  ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì—…ë¡œë“œí•˜ì„¸ìš”',
                'Thonny ìš°ì¸¡ í•˜ë‹¨ MicroPython(ESP32)ë¥¼ Local Python 3ë¡œ ë³€ê²½í•˜ì„¸ìš”',
                'í˜„ì¬ í˜ì´ì§€ì˜ "ì‹œë¦¬ì–¼í†µì‹  ì—°ê²°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ESP32ì™€ ì—°ê²°í•˜ì„¸ìš”',
                'ì›¹ìº ì´ ì¸ì‹í•œ ê²°ê³¼ê°€ ìë™ìœ¼ë¡œ ESP32ë¡œ ì „ì†¡ë©ë‹ˆë‹¤',
                'ì½”ë“œë¥¼ ìˆ˜ì •í–ˆë‹¤ë©´, ë°˜ë“œì‹œ "ì‹œë¦¬ì–¼í†µì‹  ì—°ê²°"ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ ì›¹ ë¸Œë¼ìš°ì €ì™€ ì—°ê²°ì„ ëŠê³  Thonnyë¡œ ì—…ë¡œë“œí•´ ì£¼ì„¸ìš”'
            ] : [
                'í—¤ë”ì—ì„œ ì‚¬ìš©í•  ë””ë°”ì´ìŠ¤(ë§ˆì´í¬ë¡œë¹„íŠ¸ ë˜ëŠ” ESP32)ë¥¼ ì„ íƒí•˜ì„¸ìš”',
                'í‹°ì²˜ë¸”ë¨¸ì‹ ì—ì„œ í•™ìŠµí•œ ëª¨ë¸ì˜ URLì„ ì…ë ¥í•˜ê³  "ëª¨ë¸ ë¡œë“œ"ë¥¼ í´ë¦­í•˜ì„¸ìš”',
                'ë§ˆì´í¬ë¡œë¹„íŠ¸ ì—ë””í„°ì—ì„œ ì‹œë¦¬ì–¼ í†µì‹  ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì—…ë¡œë“œí•˜ì„¸ìš”',
                'í˜„ì¬ í˜ì´ì§€ì˜ "ì‹œë¦¬ì–¼í†µì‹  ì—°ê²°" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë§ˆì´í¬ë¡œë¹„íŠ¸ì™€ ì—°ê²°í•˜ì„¸ìš”',
                'ì›¹ìº ì´ ì¸ì‹í•œ ê²°ê³¼ê°€ ìë™ìœ¼ë¡œ ë§ˆì´í¬ë¡œë¹„íŠ¸ë¡œ ì „ì†¡ë©ë‹ˆë‹¤'
            ];

            const instructionsHTML = `
                <ol>
                    ${instructions.map(step => `<li>${step}</li>`).join('')}
                </ol>
            `;
            
            document.getElementById('instructionsContent').innerHTML = instructionsHTML;

            // Show/hide code examples based on device mode
            const codeExamples = document.getElementById('codeExamples');
            if (codeExamples) {
                codeExamples.classList.toggle('hidden', !isESP32);
                if (isESP32) {
                    initializeCodeExamples();
                }
            }
        }

        // Initial render
        renderInstructions(isESP32Mode);


        function initializeCodeExamples() {
            // Example code content
            const examples = {
                basic: `# í‹°ì²˜ë¸”ë¨¸ì‹  ë°ì´í„° ì¶œë ¥í•˜ê¸°

while True:
    data = input()
    print(data)`,
                advanced: `# ìŠ¤ë§ˆíŠ¸í™ˆ ëª¨í„° ì œì–´ ì˜ˆì‹œ

from servo import Servo

motor = Servo(pin=13)

while(True):
    data = input()
    if data == 'Class 1':           # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        motor.move(90)
    elif data == 'Class 2':         # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        motor.move(30)`,
                custom: `# íŒŒì´íŒŒì´í‚¤íŠ¸ ë„¤ì˜¤í”½ì…€ ì œì–´ ì˜ˆì‹œ

from machine import Pin
from neopixel import NeoPixel

pin = Pin(14, Pin.OUT)
np = NeoPixel(pin, 12) 

while(True):
    data = input()
    if data == 'Class 1':           # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        for i in range(0, 12):
            np[i] = (255, 255, 0)   # Class 1 ë ˆì´ë¸”ì¼ ë•Œ ë…¸ë€ìƒ‰ ì¼œê¸°
        np.write()
    elif data == 'Class 2':         # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        for i in range(0, 12):
            np[i] = (0, 0, 255)     # Class 2 ë ˆì´ë¸”ì¼ ë•Œ íŒŒë€ìƒ‰ ì¼œê¸°
        np.write()`
            };

            // Function to update code content
            function updateCodeContent(exampleType) {
                const exampleContent = document.querySelector('.example-content');
                const codeElement = exampleContent.querySelector('code');
                if (codeElement) {
                    codeElement.textContent = examples[exampleType];
                    // Initialize Prism.js syntax highlighting
                    Prism.highlightElement(codeElement);
                }
            }

            // íƒ­ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
            const exampleTabs = document.querySelectorAll('.example-tab');
            exampleTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const exampleType = tab.dataset.example;
                    const exampleContent = document.querySelector('.example-content');
                    
                    // Deactivate all tabs
                    exampleTabs.forEach(t => t.classList.remove('active'));
                    // Activate clicked tab
                    tab.classList.add('active');
                    
                    // Update code content
                    updateCodeContent(exampleType);
                });
            });

            // Initialize default content
            updateCodeContent('basic');

            // Copy button functionality
            const copyBtn = document.querySelector('.copy-btn');
            if (copyBtn) {
                copyBtn.addEventListener('click', () => {
                    const codeElement = document.querySelector('.example-content code');
                    if (!codeElement) {
                        alert('ë¨¼ì € ì½”ë“œ ì˜ˆì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    const code = codeElement.textContent;
                    navigator.clipboard.writeText(code)
                        .then(() => {
                            copyBtn.textContent = 'ğŸ“‹ ë³µì‚¬ë¨!';
                            copyBtn.classList.add('success');
                            setTimeout(() => {
                                copyBtn.textContent = 'ğŸ“‹ ë³µì‚¬í•˜ê¸°';
                                copyBtn.classList.remove('success');
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Copy failed:', err);
                            copyBtn.textContent = 'âŒ ë³µì‚¬ ì‹¤íŒ¨';
                            setTimeout(() => {
                                copyBtn.textContent = 'ğŸ“‹ ë³µì‚¬í•˜ê¸°';
                            }, 2000);
                        });
                });
            }
        }

        deviceToggle.addEventListener('click', function() {
            isESP32Mode = !isESP32Mode;
            deviceToggle.classList.toggle('active', isESP32Mode);
            
            // Update instructions
            renderInstructions(isESP32Mode);
            
            if (isESP32Mode) {
                editorButton.textContent = 'Thonny IDE ë‹¤ìš´ë¡œë“œ';
                editorButton.onclick = () => window.open('https://thonny.org/', '_blank');
                if (currentDeviceSpan) currentDeviceSpan.textContent = 'ESP32';
            } else {
                editorButton.textContent = 'ë§ˆì´í¬ë¡œë¹„íŠ¸ ì—ë””í„° ì—´ê¸°';
                editorButton.onclick = () => window.open('https://makecode.microbit.org/#editor', '_blank');
                if (currentDeviceSpan) currentDeviceSpan.textContent = 'ë§ˆì´í¬ë¡œë¹„íŠ¸';
            }
            
            // í—¤ë” ì œëª© ì—…ë°ì´íŠ¸
            updateHeaderTitle(isESP32Mode);
            
            // ì „ì—­ ë³€ìˆ˜ë¡œ í˜„ì¬ ëª¨ë“œ ì„¤ì •
            window.currentDeviceMode = isESP32Mode ? 'esp32' : 'microbit';
        });

        // ëª¨ë¸ ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
        if (loadModelBtn) {
            loadModelBtn.addEventListener('click', function() {
                const url = modelUrlInput.value.trim();
                if (url && window.setModelUrl) {
                    window.setModelUrl(url);
                } else {
                    alert('ì˜¬ë°”ë¥¸ ëª¨ë¸ URLì„ ì…ë ¥í•˜ì„¸ìš”.');
                }
            });
        }

        // ì‹œë¦¬ì–¼ ì—°ê²° ë²„íŠ¼ ì´ë²¤íŠ¸
        if (serialButton) {
            serialButton.addEventListener('click', function() {
                if (window.newConnect) {
                    window.newConnect();
                }
            });
        }

        // ì´ˆê¸° ìƒíƒœ ì„¤ì •
        window.currentDeviceMode = 'microbit';
        updateHeaderTitle(false);
    </script>
    
    <script src="sketch.js"></script>
</body>
</html>