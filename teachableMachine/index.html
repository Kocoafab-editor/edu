<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í‹°ì²˜ë¸”ë¨¸ì‹  ì´ë¯¸ì§€ ì¸ì‹ - ë§ˆì´í¬ë¡œë¹„íŠ¸/ESP32 ì—°ë™</title>
    <link rel="icon" type="image/png" sizes="32x32" href="../static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../static/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../static/favicon/favicon-16x16.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script src="https://unpkg.com/ml5@0.6.1/dist/ml5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/makeabilitylab/p5js/_libraries/serial.js"></script>
    <link rel="stylesheet" href="../common/header.css">
    <link rel="stylesheet" href="../common/navigation.css">
    <link rel="stylesheet" href="../common/template.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="../common/menu.js"></script>
</head>

<body class="serial-connection">
    <div class="header">
        <a href="../index.html" class="back-btn" title="ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°">&lt; ë©”ì¸í™”ë©´</a>
        <div class="header-content">
            <!-- ì ‘ê¸°/í¼ì¹˜ê¸° ë²„íŠ¼ -->
            <button id="headerToggleBtn" class="btn-small header-toggle-btn" title="ì„¤ì • ì ‘ê¸°/í¼ì¹˜ê¸°"></button>
            <div>
                <!-- ê¸°ì¡´ í—¤ë” íƒ€ì´í‹€/ì„¤ëª… -->
                <div class="header-title-desc">
                  <h1 id="headerTitle">ë§ˆì´í¬ë¡œë¹„íŠ¸ì™€ í‹°ì²˜ë¸”ë¨¸ì‹  ì—°ë™í•˜ê¸°</h1>
                  <p>ì›¹ìº ì„ í†µí•œ ì‹¤ì‹œê°„ ì´ë¯¸ì§€ ì¸ì‹ìœ¼ë¡œ ë§ˆì´í¬ë¡œë¹„íŠ¸/esp32 ì œì–´</p>
                  <p class="mobile-hint" style="display:none; color:#4a5568; margin-top:6px;">ìš°ì¸¡ ìƒë‹¨ì˜ í–„ë²„ê±° ë²„íŠ¼ì„ ëˆŒëŸ¬ ì„¤ì •í•˜ì„¸ìš”.</p>
                </div>
                <div class="header-settings-bar">
                    <!-- 1. MCU í† ê¸€ + ì—ë””í„° ë²„íŠ¼ (ì™¼ìª½) -->
                  <div class="header-settings-col header-settings-left">
                    <div class="settings-title">ë””ë°”ì´ìŠ¤ ì„ íƒ</div>
                    <div class="toggle-container">
                      <span class="toggle-label">ë§ˆì´í¬ë¡œë¹„íŠ¸</span>
                      <div class="toggle-switch" id="deviceToggle">
                        <div class="toggle-slider"></div>
                      </div>
                      <span class="toggle-label">ESP32</span>
                    </div>
                    <button id="editorButton" class="btn" onclick="window.open('https://makecode.microbit.org/#editor', '_blank')">
                      ë§ˆì´í¬ë¡œë¹„íŠ¸ ì—ë””í„° ì—´ê¸°
                    </button>
                  </div>
                  <!-- 2. ëª¨ë¸ URL ì…ë ¥ (ê°€ìš´ë°) -->
                  <div class="header-settings-col header-settings-center">
                    <div class="settings-title">í‹°ì²˜ë¸”ë¨¸ì‹  URL</div>
                    <form id="modelUrlForm" onsubmit="event.preventDefault(); document.getElementById('loadModelBtn').click();">
                      <input type="text" id="modelUrlInput" class="form-input"
                             placeholder="https://teachablemachine.withgoogle.com/models/xxxxxx/">
                      <button id="loadModelBtn" class="btn">ëª¨ë¸ ë¡œë“œ</button>
                    </form>
                  </div>
                  <!-- 3. ì‹œë¦¬ì–¼ ì—°ê²° (ì˜¤ë¥¸ìª½) -->
                  <div class="header-settings-col header-settings-right">
                    <div class="settings-title">ë””ë°”ì´ìŠ¤ ì—°ê²°</div>
                    <div class="toggle-container">
                      <span class="toggle-label">ì‹œë¦¬ì–¼ í†µì‹ </span>
                      <div class="toggle-switch" id="connectionToggle">
                        <div class="toggle-slider"></div>
                      </div>
                      <span class="toggle-label">ë¸”ë£¨íˆ¬ìŠ¤</span>
                    </div>
                    <button id="serialButton" class="btn">ì‹œë¦¬ì–¼í†µì‹  ì—°ê²°</button>
                  </div>
                </div>
            </div>
            <!-- ëª¨ë°”ì¼: í–„ë²„ê±° ë²„íŠ¼ & ì˜¤ë²„ë ˆì´ -->
            <button class="hamburger-btn" id="hamburgerBtn" aria-label="ë©”ë‰´ ì—´ê¸°"><span></span><span></span><span></span></button>
            <div class="nav-overlay" id="navOverlay">
                <div class="nav-overlay-content">
                    <div id="overlaySettingsMount"></div>
                </div>
            </div>
        </div>
      </div>
    </div>

    <div class="container">
        <div class="main-section">


            <!-- í‹°ì²˜ë¸”ë¨¸ì‹  ëª¨ë¸ ì„¤ì • -->
            

            <div class="content-section">
                <div class="video-section">
                    <div class="video-container" id="video-container">
                      <div class="canvas-wrapper" id="canvasContainer">
                        <!-- p5.js canvas will be inserted here -->
                      </div>
                      <div class="video-title">ì‹¤ì‹œê°„ ì¹´ë©”ë¼</div>
                    </div>

                    <div class="status-panel">
                        <div class="video-title">ìƒíƒœ ì •ë³´</div>
                        <div class="status-item">
                            <span class="status-label">ëª¨ë¸ ìƒíƒœ:</span>
                            <span id="modelStatus" class="status-value status-waiting">ëŒ€ê¸°ì¤‘</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label" id="connectionTypeLabel">ì‹œë¦¬ì–¼ ì—°ê²°:</span>
                            <span id="serialStatus" class="status-value status-disconnected">ì—°ê²° ì•ˆë¨</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">í˜„ì¬ ë””ë°”ì´ìŠ¤:</span>
                            <span id="currentDevice" class="status-value status-ready">ë§ˆì´í¬ë¡œë¹„íŠ¸</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">ì¸ì‹ ê²°ê³¼:</span>
                            <span id="recognitionResult" class="status-value status-waiting">-</span>
                        </div>
                    </div>
                </div>

                <div class="instructions">
                    <h3>ğŸ“‹ ì‚¬ìš© ë°©ë²• <span id="instructionsModeLabel"></span></h3>
                    <div id="instructionsContent">
                        <!-- Instructions will be rendered here by JavaScript -->
                    </div>
                </div>

                <div id="codeExamples" class="code-contents hidden">
                    <h3>ğŸ’» ì‚¬ìš© ì˜ˆì‹œ <span id="exampleModeLabel"></span></h3>
                    <div id="exampleNotice" class="hidden" style="margin: 8px 0 12px; font-weight: 400;">
                        â— simpleBLE ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì—†ìœ¼ë©´ Thonnyì˜ íŒ¨í‚¤ì§€ ê´€ë¦¬ì—ì„œ kocoafab ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë‹¤ì‹œ ì„¤ì¹˜í•´ ì£¼ì„¸ìš”.
                    </div>
                    <div class="code-examples">
                        <div class="example-tabs">
                            <button class="example-tab active" data-example="basic">ê¸°ë³¸ ì˜ˆì‹œ</button>
                            <button class="example-tab" data-example="advanced">ìŠ¤ë§ˆíŠ¸í™ˆPlus í‚¤íŠ¸ ëª¨í„° ì œì–´ ì˜ˆì‹œ</button>
                            <button class="example-tab" data-example="custom">íŒŒì´íŒŒì´í‚¤íŠ¸ ë„¤ì˜¤í”½ì…€ ì œì–´ ì˜ˆì‹œ</button>
                        </div>
                        <div class="example-content">
                            <pre class="line-numbers"><code class="language-python">
                                </code></pre>
                            <button class="copy-btn">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let isESP32Mode = false;

        const headerSettingsBar = document.querySelector('.header-settings-bar');
        const headerToggleBtn = document.getElementById('headerToggleBtn');
        if(headerToggleBtn && headerSettingsBar) {
            headerToggleBtn.addEventListener('click', () => {
                const isClosed = headerSettingsBar.classList.toggle('closed');
                headerToggleBtn.classList.toggle('closed');
                
                // ëª¨ë°”ì¼ì—ì„œëŠ” í—¤ë” ë†’ì´ê°€ ê³ ì •ì´ë¯€ë¡œ íŒ¨ë”© ì¡°ì •í•˜ì§€ ì•ŠìŒ
                const isMobile = window.matchMedia('(max-width: 900px)').matches;
                if (isMobile) return;

                // ì»¨í…Œì´ë„ˆì˜ padding-top ê°’ì„ ë°ìŠ¤í¬í†±ì—ì„œë§Œ ë³€ê²½
                const container = document.querySelector('.serial-connection .container');
                if (container) {
                    container.style.paddingTop = isClosed ? '180px' : '360px';
                }
            });
        }
        
        // DOM ìš”ì†Œë“¤
        const deviceToggle = document.getElementById('deviceToggle');
        const editorButton = document.getElementById('editorButton');
        const currentDeviceSpan = document.getElementById('currentDevice');
        const modelUrlInput = document.getElementById('modelUrlInput');
        const loadModelBtn = document.getElementById('loadModelBtn');
        const serialButton = document.getElementById('serialButton');
        const connectionToggle = document.getElementById('connectionToggle');
        const headerTitle = document.getElementById('headerTitle');
        
        // ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
        window.updateModelStatus = function(status, className = 'status-waiting') {
            const element = document.getElementById('modelStatus');
            if (element) {
                element.textContent = status;
                element.className = 'status-value ' + className;
            }
        };
        
        window.updateSerialStatus = function(status, className = 'status-disconnected') {
            const element = document.getElementById('serialStatus');
            if (element) {
                element.textContent = status;
                element.className = 'status-value ' + className;
            }
        };

        // ì—°ê²° íƒ€ì… ë¼ë²¨ ì—…ë°ì´íŠ¸ (ì‹œë¦¬ì–¼/ë¸”ë£¨íˆ¬ìŠ¤)
        function updateConnectionTypeLabel() {
            const labelEl = document.getElementById('connectionTypeLabel');
            if (!labelEl) return;
            labelEl.textContent = (window.isBluetoothMode ? 'ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°:' : 'ì‹œë¦¬ì–¼ ì—°ê²°:');
        }
        
        window.updateRecognitionResult = function(result) {
            const element = document.getElementById('recognitionResult');
            if (element) {
                element.textContent = result;
                element.className = 'status-value status-ready';
            }
        };

        // í—¤ë” ì œëª© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateHeaderTitle(isESP32) {
            const deviceName = isESP32 ? 'ESP32' : 'ë§ˆì´í¬ë¡œë¹„íŠ¸';
            headerTitle.textContent = `${deviceName}ì™€ í‹°ì²˜ë¸”ë¨¸ì‹  ì—°ë™í•˜ê¸°`;
        }

        // ë””ë°”ì´ìŠ¤ í† ê¸€ ì´ë²¤íŠ¸
        // Function to render instructions based on current device
        function renderInstructions(isESP32) {
            let instructions;
            if (isESP32) {
                // ESP32: ì‹œë¦¬ì–¼/ë¸”ë£¨íˆ¬ìŠ¤ ë¶„ê¸°
                if (window.isBluetoothMode) {
                    instructions = [
                        'Web Bluetoothë¥¼ ì§€ì›í•˜ëŠ” ê¸°ê¸°(PC/ëª¨ë°”ì¼)ì˜ Chrome/Edge ë¸Œë¼ìš°ì €ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤.<br>  - Androidì˜ ê²½ìš° <a href="https://play.google.com/store/apps/details?id=com.android.chrome&hl=ko" target="_blank">Chrome ë¸Œë¼ìš°ì €</a>ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.<br>  - iPhone(iOS Safari)ì€ Web Bluetoothë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚¬ìš©ì„ ìœ„í•´ <a href="https://apps.apple.com/app/bluefy/id6462895808" target="_blank">Bluefy App</a>ì„ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.',
                        'í—¤ë”ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”',
                        'í‹°ì²˜ë¸”ë¨¸ì‹  ëª¨ë¸ URLì„ ì…ë ¥í•˜ê³  "ëª¨ë¸ ë¡œë“œ"ë¥¼ í´ë¦­í•˜ì„¸ìš”',
                        'Thonnyì—ì„œ ESP32ìš© BLE ì½”ë“œë¥¼ ì‘ì„±/ì—…ë¡œë“œí•˜ì„¸ìš”',
                        'Thonnyì—ì„œ ì‹¤í–‰->ì¸í„°í”„ë¦¬í„° í™˜ê²½ì„¤ì •ì—ì„œ<br>ì‹¤í–‰ í™˜ê²½(ì¸í„°í”„ë¦¬í„° íƒ­ì˜ ìƒë‹¨ ë“œë¡­ë‹¤ìš´)ì„ Local Python3ë¡œ ì„¤ì •í•˜ì„¸ìš”',
                        'ìƒë‹¨ "ì—°ê²°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°ì„ ì§„í–‰í•˜ì„¸ìš”',
                        'ì›¹ìº  ì¸ì‹ ê²°ê³¼ê°€ BLEë¡œ ESP32ì— ì „ì†¡ë©ë‹ˆë‹¤',
                        'ì½”ë“œ ìˆ˜ì • ì‹œ ì—°ê²°ì„ ëŠê³ (ì—°ê²° í•´ì œ) ì—…ë¡œë“œ í›„ ë‹¤ì‹œ ì—°ê²°í•˜ì„¸ìš”'
                    ];
                } else {
                    instructions = [
                        'í—¤ë”ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”',
                        'í‹°ì²˜ë¸”ë¨¸ì‹  ëª¨ë¸ URLì„ ì…ë ¥í•˜ê³  "ëª¨ë¸ ë¡œë“œ"ë¥¼ í´ë¦­í•˜ì„¸ìš”',
                        'Thonnyì—ì„œ ESP32ìš© ì‹œë¦¬ì–¼ í†µì‹  ì½”ë“œë¥¼ ì‘ì„±/ì—…ë¡œë“œí•˜ì„¸ìš”',
                        'Thonnyì—ì„œ ì‹¤í–‰->ì¸í„°í”„ë¦¬í„° í™˜ê²½ì„¤ì •ì—ì„œ<br>ì‹¤í–‰ í™˜ê²½(ì¸í„°í”„ë¦¬í„° íƒ­ì˜ ìƒë‹¨ ë“œë¡­ë‹¤ìš´)ì„ Local Python3ë¡œ ì„¤ì •í•˜ì„¸ìš”',
                        'ìƒë‹¨ "ì—°ê²°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œë¦¬ì–¼ ì—°ê²°ì„ ì§„í–‰í•˜ì„¸ìš”',
                        'ì›¹ìº  ì¸ì‹ ê²°ê³¼ê°€ ì‹œë¦¬ì–¼ë¡œ ESP32ì— ì „ì†¡ë©ë‹ˆë‹¤',
                        'ì½”ë“œ ìˆ˜ì • ì‹œ ì—°ê²°ì„ ëŠê³ (ì—°ê²° í•´ì œ) ì—…ë¡œë“œ í›„ ë‹¤ì‹œ ì—°ê²°í•˜ì„¸ìš”'
                    ];
                }
            } else {
                // ë§ˆì´í¬ë¡œë¹„íŠ¸: ì‹œë¦¬ì–¼/ë¸”ë£¨íˆ¬ìŠ¤ ë¶„ê¸°
                if (window.isBluetoothMode) {
                    instructions = [
                        'Web Bluetoothë¥¼ ì§€ì›í•˜ëŠ” ê¸°ê¸°(PC/ëª¨ë°”ì¼)ì˜ Chrome/Edge ë¸Œë¼ìš°ì €ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤.<br>  - Androidì˜ ê²½ìš° <a href="https://play.google.com/store/apps/details?id=com.android.chrome&hl=ko" target="_blank">Chrome ë¸Œë¼ìš°ì €</a>ë¥¼ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.<br>  - iPhone(iOS Safari)ì€ Web Bluetoothë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì‚¬ìš©ì„ ìœ„í•´ <a href="https://apps.apple.com/app/bluefy/id6462895808" target="_blank">Bluefy App</a>ì„ ì‚¬ìš©í•´ ì£¼ì„¸ìš”.',
                        'í—¤ë”ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”',
                        'í‹°ì²˜ë¸”ë¨¸ì‹  ëª¨ë¸ URLì„ ì…ë ¥í•˜ê³  "ëª¨ë¸ ë¡œë“œ"ë¥¼ í´ë¦­í•˜ì„¸ìš”',
                        'ë§ˆì´í¬ë¡œë¹„íŠ¸ì— BLE í†µì‹  í”„ë¡œê·¸ë¨ì„ ì—…ë¡œë“œí•˜ì„¸ìš”',
                        'ìƒë‹¨ "ì—°ê²°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°ì„ ì§„í–‰í•˜ì„¸ìš”',
                        'ì›¹ìº  ì¸ì‹ ê²°ê³¼ê°€ BLEë¡œ ë§ˆì´í¬ë¡œë¹„íŠ¸ì— ì „ì†¡ë©ë‹ˆë‹¤'
                    ];
                } else {
                    instructions = [
                        'í—¤ë”ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”',
                        'í‹°ì²˜ë¸”ë¨¸ì‹  ëª¨ë¸ URLì„ ì…ë ¥í•˜ê³  "ëª¨ë¸ ë¡œë“œ"ë¥¼ í´ë¦­í•˜ì„¸ìš”',
                        'ë§ˆì´í¬ë¡œë¹„íŠ¸ ì—ë””í„°ì—ì„œ ì‹œë¦¬ì–¼ í†µì‹  ì½”ë“œë¥¼ ì‘ì„±/ì—…ë¡œë“œí•˜ì„¸ìš”',
                        'ìƒë‹¨ "ì—°ê²°" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œë¦¬ì–¼ ì—°ê²°ì„ ì§„í–‰í•˜ì„¸ìš”',
                        'ì›¹ìº  ì¸ì‹ ê²°ê³¼ê°€ ì‹œë¦¬ì–¼ë¡œ ë§ˆì´í¬ë¡œë¹„íŠ¸ì— ì „ì†¡ë©ë‹ˆë‹¤'
                    ];
                }
            }

            const instructionsHTML = `
                <ol>
                    ${instructions.map(step => `<li>${step}</li>`).join('')}
                </ol>
            `;
            
            document.getElementById('instructionsContent').innerHTML = instructionsHTML;

            // íƒ€ì´í‹€ ëª¨ë“œ ë¼ë²¨ ê°±ì‹ 
            const instructionsModeLabel = document.getElementById('instructionsModeLabel');
            if (instructionsModeLabel) {
                instructionsModeLabel.textContent = window.isBluetoothMode ? '(ë¸”ë£¨íˆ¬ìŠ¤)' : '(ì‹œë¦¬ì–¼)';
            }

            // Show/hide code examples based on device mode
            const codeExamples = document.getElementById('codeExamples');
            if (codeExamples) {
                codeExamples.classList.toggle('hidden', !isESP32);
                if (isESP32) {
                    initializeCodeExamples();
                }
            }
        }

        // Initial render
        renderInstructions(isESP32Mode);
        // ì´ˆê¸°ì—ë„ ì˜ˆì‹œ ê³µì§€ì™€ ë¼ë²¨/ë‚´ìš©ì„ í˜„ì¬ ëª¨ë“œì— ë§ì¶° ë™ê¸°í™”
        try {
            window.updateExampleModeLabel && window.updateExampleModeLabel();
            window.updateExampleContentForMode && window.updateExampleContentForMode();
            window.updateExampleNotice && window.updateExampleNotice();
            updateConnectionTypeLabel();
            if (serialButton) serialButton.textContent = (window.isBluetoothMode ? 'ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°' : 'ì‹œë¦¬ì–¼í†µì‹  ì—°ê²°');
        } catch (e) {}


        function initializeCodeExamples() {
            // Example code content (mode-separated)
            const examples = {
                serial: {
                    basic: `# í‹°ì²˜ë¸”ë¨¸ì‹  ë°ì´í„° ì¶œë ¥í•˜ê¸°

while True:
    data = input()
    print(data)`,
                    advanced: `# ìŠ¤ë§ˆíŠ¸í™ˆ ëª¨í„° ì œì–´ ì˜ˆì‹œ

from servo import Servo

motor = Servo(pin=13)

while(True):
    data = input()
    if data == 'Class 1':           # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        motor.move(90)
    elif data == 'Class 2':         # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        motor.move(30)`,
                    custom: `# íŒŒì´íŒŒì´í‚¤íŠ¸ ë„¤ì˜¤í”½ì…€ ì œì–´ ì˜ˆì‹œ

from machine import Pin
from neopixel import NeoPixel

pin = Pin(14, Pin.OUT)
np = NeoPixel(pin, 12) 

while(True):
    data = input()
    if data == 'Class 1':           # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        for i in range(0, 12):
            np[i] = (255, 255, 0)   # Class 1 ë ˆì´ë¸”ì¼ ë•Œ ë…¸ë€ìƒ‰ ì¼œê¸°
        np.write()
    elif data == 'Class 2':         # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        for i in range(0, 12):
            np[i] = (0, 0, 255)     # Class 2 ë ˆì´ë¸”ì¼ ë•Œ íŒŒë€ìƒ‰ ì¼œê¸°
        np.write()`
                },
                bluetooth: {
                    // ì´ˆê¸°ì—ëŠ” ì‹œë¦¬ì–¼ ì˜ˆì‹œì™€ ë™ì¼í•˜ê²Œ êµ¬ì„± (ì¶”í›„ ì‚¬ìš©ì êµì²´ ì˜ˆì •)
                    basic: `# í‹°ì²˜ë¸”ë¨¸ì‹  ë°ì´í„° ì¶œë ¥í•˜ê¸°
import ubluetooth
from simpleBle import WebBLEPeripheral

ble = ubluetooth.BLE()
ble.active(True)

p = WebBLEPeripheral(ble, "ESP32_BLE")  # ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²° ì´ë¦„


def on_rx(v):
    print("ìˆ˜ì‹ ", v)
    p.send(f"ë°›ì€ ë©”ì‹œì§€: {v}")

print("ì—°ê²° ëŒ€ê¸° ì¤‘...")
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    p.stop()
    `,
                    advanced: `# ìŠ¤ë§ˆíŠ¸í™ˆ ëª¨í„° ì œì–´ ì˜ˆì‹œ

from servo import Servo
import ubluetooth
from simpleBle import WebBLEPeripheral

ble = ubluetooth.BLE()
ble.active(True)

p = WebBLEPeripheral(ble, "ESP32_BLE")  # ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²° ì´ë¦„

motor = Servo(pin=13)

def on_rx(v):
    if v == 'Class 1':           # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        motor.move(90)
    elif v == 'Class 2':         # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        motor.move(30)
        
print("ì—°ê²° ëŒ€ê¸° ì¤‘...")
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    p.stop()`,
                    custom: `# íŒŒì´íŒŒì´í‚¤íŠ¸ ë„¤ì˜¤í”½ì…€ ì œì–´ ì˜ˆì‹œ

from machine import Pin
from neopixel import NeoPixel
import ubluetooth
from simpleBle import WebBLEPeripheral

pin = Pin(14, Pin.OUT)
np = NeoPixel(pin, 12) 

ble = ubluetooth.BLE()
ble.active(True)

p = WebBLEPeripheral(ble, "ESP32_BLE")  # ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²° ì´ë¦„


def on_rx(v):
    if v == 'Class 1':           # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        for i in range(0, 12):
            np[i] = (255, 255, 0)   # Class 1 ë ˆì´ë¸”ì¼ ë•Œ ë…¸ë€ìƒ‰ ì¼œê¸°
        np.write()
    elif v == 'Class 2':         # í‹°ì²˜ë¸”ë¨¸ì‹  ë ˆì´ë¸” ì´ë¦„ì— ë§ê²Œ ë³€ê²½ 
        for i in range(0, 12):
            np[i] = (0, 0, 255)     # Class 2 ë ˆì´ë¸”ì¼ ë•Œ íŒŒë€ìƒ‰ ì¼œê¸°
        np.write()
        
print("ì—°ê²° ëŒ€ê¸° ì¤‘...")
try:
    while True:
        time.sleep(1)
except KeyboardInterrupt:
    p.stop()`,
                }
            };

            // Function to update code content
            function updateCodeContent(exampleType) {
                const exampleContent = document.querySelector('.example-content');
                const codeElement = exampleContent.querySelector('code');
                if (codeElement) {
                    const mode = window.isBluetoothMode ? 'bluetooth' : 'serial';
                    const modeExamples = examples[mode] || examples.serial;
                    codeElement.textContent = modeExamples[exampleType];
                    // Initialize Prism.js syntax highlighting
                    Prism.highlightElement(codeElement);
                }
            }

            // Function to update example mode label (ì‹œë¦¬ì–¼/ë¸”ë£¨íˆ¬ìŠ¤)
            function updateExampleModeLabel() {
                const labelEl = document.getElementById('exampleModeLabel');
                if (!labelEl) return;
                labelEl.textContent = window.isBluetoothMode ? '(ë¸”ë£¨íˆ¬ìŠ¤)' : '(ì‹œë¦¬ì–¼)';
            }

            // Function to update code content for current active tab when mode changes
            function updateExampleContentForMode() {
                const activeTab = document.querySelector('.example-tab.active');
                const currentType = activeTab ? activeTab.dataset.example : 'basic';
                updateCodeContent(currentType);
            }

            // Function to toggle example notice (ESP32 + Bluetooth only)
            function updateExampleNotice() {
                const noticeEl = document.getElementById('exampleNotice');
                if (!noticeEl) return;
                const shouldShow = (window.currentDeviceMode === 'esp32') && !!window.isBluetoothMode;
                noticeEl.classList.toggle('hidden', !shouldShow);
            }

            // íƒ­ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
            const exampleTabs = document.querySelectorAll('.example-tab');
            exampleTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const exampleType = tab.dataset.example;
                    const exampleContent = document.querySelector('.example-content');
                    
                    // Deactivate all tabs
                    exampleTabs.forEach(t => t.classList.remove('active'));
                    // Activate clicked tab
                    tab.classList.add('active');
                    
                    // Update code content
                    updateCodeContent(exampleType);
                });
            });

            // Initialize default content
            updateCodeContent('basic');
            updateExampleModeLabel();
            updateExampleNotice();

            // Copy button functionality
            const copyBtn = document.querySelector('.copy-btn');
            if (copyBtn) {
                copyBtn.addEventListener('click', () => {
                    const codeElement = document.querySelector('.example-content code');
                    if (!codeElement) {
                        alert('ë¨¼ì € ì½”ë“œ ì˜ˆì‹œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    const code = codeElement.textContent;
                    navigator.clipboard.writeText(code)
                        .then(() => {
                            copyBtn.textContent = 'ğŸ“‹ ë³µì‚¬ë¨!';
                            copyBtn.classList.add('success');
                            setTimeout(() => {
                                copyBtn.textContent = 'ğŸ“‹ ë³µì‚¬í•˜ê¸°';
                                copyBtn.classList.remove('success');
                            }, 2000);
                        })
                        .catch(err => {
                            console.error('Copy failed:', err);
                            copyBtn.textContent = 'âŒ ë³µì‚¬ ì‹¤íŒ¨';
                            setTimeout(() => {
                                copyBtn.textContent = 'ğŸ“‹ ë³µì‚¬í•˜ê¸°';
                            }, 2000);
                        });
                });
            }

            // ê³µê°œ: ì™¸ë¶€ì—ì„œ ë¼ë²¨ ê°±ì‹  í˜¸ì¶œ ê°€ëŠ¥
            window.updateExampleModeLabel = updateExampleModeLabel;
            window.updateExampleContentForMode = updateExampleContentForMode;
            window.updateExampleNotice = updateExampleNotice;
        }

        deviceToggle.addEventListener('click', function() {
            isESP32Mode = !isESP32Mode;
            deviceToggle.classList.toggle('active', isESP32Mode);
            // ì „ì—­ ë³€ìˆ˜ë¡œ í˜„ì¬ ëª¨ë“œ ë¨¼ì € ì„¤ì • (ì˜ˆì‹œ ë…¸ì¶œ ë¡œì§ì´ ì´ ê°’ì— ì˜ì¡´)
            window.currentDeviceMode = isESP32Mode ? 'esp32' : 'microbit';
            
            // Update instructions
            renderInstructions(isESP32Mode);
            
            if (isESP32Mode) {
                editorButton.textContent = 'Thonny IDE ë‹¤ìš´ë¡œë“œ';
                editorButton.onclick = () => window.open('https://thonny.org/', '_blank');
                if (currentDeviceSpan) currentDeviceSpan.textContent = 'ESP32';
            } else {
                editorButton.textContent = 'ë§ˆì´í¬ë¡œë¹„íŠ¸ ì—ë””í„° ì—´ê¸°';
                editorButton.onclick = () => window.open('https://makecode.microbit.org/#editor', '_blank');
                if (currentDeviceSpan) currentDeviceSpan.textContent = 'ë§ˆì´í¬ë¡œë¹„íŠ¸';
            }
            
            // í—¤ë” ì œëª© ì—…ë°ì´íŠ¸
            updateHeaderTitle(isESP32Mode);

            // ì˜ˆì‹œ ë¼ë²¨/ì½˜í…ì¸ /ê³µì§€ ì¦‰ì‹œ ë™ê¸°í™”
            try {
                if (typeof window.updateExampleModeLabel === 'function') window.updateExampleModeLabel();
                if (typeof window.updateExampleContentForMode === 'function') window.updateExampleContentForMode();
                if (typeof window.updateExampleNotice === 'function') window.updateExampleNotice();
                updateConnectionTypeLabel();
            } catch (e) {}

            // BLE ëª¨ë“œ ë™ê¸°í™”
            try {
                if (typeof bleManager !== 'undefined' && bleManager) {
                    bleManager.setMode(isESP32Mode ? 'esp32' : 'microbit');
                }
            } catch (e) {
                console.warn('BLE mode sync failed:', e);
            }

            // í…Œë§ˆ í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
            try {
                const bodyEl = document.body;
                bodyEl.classList.remove('theme-esp32', 'theme-microbit');
                bodyEl.classList.add(isESP32Mode ? 'theme-esp32' : 'theme-microbit');
            } catch (e) {}
        });

        // ëª¨ë¸ ë¡œë“œ ë²„íŠ¼ ì´ë²¤íŠ¸
        if (loadModelBtn) {
            loadModelBtn.addEventListener('click', function() {
                const url = modelUrlInput.value.trim();
                if (url && window.setModelUrl) {
                    window.setModelUrl(url);
                } else {
                    alert('ì˜¬ë°”ë¥¸ ëª¨ë¸ URLì„ ì…ë ¥í•˜ì„¸ìš”.');
                }
            });
        }

        // í™˜ê²½ ê°ì§€ ìœ í‹¸ (ëª¨ë°”ì¼/íƒœë¸”ë¦¿ ì‹ë³„)
        function isIPadOSDesktopClass() {
            try {
                return navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1;
            } catch (e) { return false; }
        }
        function detectMobileDevice() {
            const ua = (navigator.userAgent || navigator.vendor || '');
            const isMobileUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|Tablet|Silk|Kindle/i.test(ua);
            return isMobileUA || isIPadOSDesktopClass();
        }

        // ì—°ê²° ëª¨ë“œ ìƒíƒœ (ëª¨ë°”ì¼ ìš°ì„  ì ìš©ì„ ìœ„í•´ ë¨¼ì € ì„ ì–¸)
        let isBluetoothMode = false;
        // ì™¸ë¶€(ìŠ¤ì¼€ì¹˜)ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ê³µê°œ
        window.isBluetoothMode = isBluetoothMode;

        // í™˜ê²½ ê°ì§€ ì ìš©: ëª¨ë°”ì¼/íƒœë¸”ë¦¿ì´ë©´ ì‹œë¦¬ì–¼ ì œí•œ, ë¸”ë£¨íˆ¬ìŠ¤ ê°•ì œ
        const isMobileDevice = detectMobileDevice();
        window.isMobileDevice = isMobileDevice;

        if (isMobileDevice) {
            // ê°•ì œ BLE ëª¨ë“œ
            isBluetoothMode = true;
            window.isBluetoothMode = true;
            if (connectionToggle) {
                connectionToggle.classList.add('active');
                connectionToggle.classList.add('locked');
                connectionToggle.title = 'ëª¨ë°”ì¼ì—ì„œëŠ” ë¸”ë£¨íˆ¬ìŠ¤ë§Œ ì§€ì›ë©ë‹ˆë‹¤';
                connectionToggle.style.pointerEvents = 'none';
            }
            // í† ê¸€ ë¼ë²¨ì„ ë¸”ë£¨íˆ¬ìŠ¤ ê¸°ì¤€ìœ¼ë¡œ ë³´ì´ê²Œ ì—…ë°ì´íŠ¸
            try {
                const labels = connectionToggle?.parentElement?.querySelectorAll('.toggle-label');
                if (labels && labels.length === 2) {
                    labels[0].style.opacity = '0.4';
                    labels[1].style.opacity = '1';
                }
            } catch (e) {}
            if (serialButton) {
                serialButton.textContent = 'ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°';
            }
            if (typeof window.closeSerialPort === 'function') {
                try { window.closeSerialPort(); } catch (e) {}
            }
            // UI ë™ê¸°í™”
            renderInstructions(isESP32Mode);
            if (typeof window.updateExampleModeLabel === 'function') window.updateExampleModeLabel();
            if (typeof window.updateExampleContentForMode === 'function') window.updateExampleContentForMode();
            if (typeof window.updateExampleNotice === 'function') window.updateExampleNotice();
            updateConnectionTypeLabel();
        }

        // ì—°ê²° í† ê¸€ ì´ë²¤íŠ¸
        if (connectionToggle) {
            connectionToggle.addEventListener('click', function() {
                if (window.isMobileDevice) {
                    alert('ëª¨ë°”ì¼ì—ì„œëŠ” ë¸”ë£¨íˆ¬ìŠ¤ë§Œ ì§€ì›ë©ë‹ˆë‹¤.');
                    return;
                }
                isBluetoothMode = !isBluetoothMode;
                connectionToggle.classList.toggle('active', isBluetoothMode);
                if (serialButton) {
                    serialButton.textContent = isBluetoothMode ? 'ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°' : 'ì‹œë¦¬ì–¼í†µì‹  ì—°ê²°';
                }
                // ì™¸ë¶€ ë…¸ì¶œ ìƒíƒœ ë™ê¸°í™”
                window.isBluetoothMode = isBluetoothMode;

                // BLE ëª¨ë“œë¡œ ì „í™˜ë˜ë©´ ì‹œë¦¬ì–¼ í¬íŠ¸ë¥¼ ë‹«ì•„ ì „ì†¡ ê²½ë¡œë¥¼ ì¼ê´€í™”
                if (isBluetoothMode && typeof window.closeSerialPort === 'function') {
                    window.closeSerialPort();
                }

                // ì˜ˆì‹œ ë¼ë²¨ ê°±ì‹ 
                try {
                    if (typeof window.updateExampleModeLabel === 'function') window.updateExampleModeLabel();
                    if (typeof window.updateExampleContentForMode === 'function') window.updateExampleContentForMode();
                    if (typeof window.updateExampleNotice === 'function') window.updateExampleNotice();
                    updateConnectionTypeLabel();
                } catch (e) {}

                // ì‚¬ìš© ë°©ë²•(Instructions)ë„ í˜„ì¬ ë””ë°”ì´ìŠ¤/ëª¨ë“œì— ë§ì¶° ì¬ë Œë”ë§
                renderInstructions(isESP32Mode);
            });
        }

        // BLE ë§¤ë‹ˆì € ì¸ìŠ¤í„´ìŠ¤ (í•„ìš” ì‹œ ìƒì„±)
        let bleManager = null;

        // ë””ë°”ì´ìŠ¤(ì—°ê²°) ë²„íŠ¼ ì´ë²¤íŠ¸
        if (serialButton) {
            serialButton.addEventListener('click', async function() {
                if (isBluetoothMode) {
                    try {
                        if (!navigator.bluetooth) {
                            alert('ì´ ë¸Œë¼ìš°ì €ëŠ” Web Bluetoothë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. Chrome/Edgeë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
                            return;
                        }
                        if (!bleManager) {
                            if (!window.BLE || !window.BLE.BLEManager) {
                                alert('BLE ëª¨ë“ˆ ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                                return;
                            }
                            bleManager = new window.BLE.BLEManager();
                            // ë””ë°”ì´ìŠ¤ í† ê¸€ ìƒíƒœì— ë§ì¶° ëª¨ë“œ ì„¤ì •
                            bleManager.setMode(isESP32Mode ? 'esp32' : 'microbit');
                            // ìƒíƒœ ë³€ê²½ ì‹œ ìƒë‹¨ ìƒíƒœ íŒ¨ë„ ì—…ë°ì´íŠ¸
                            bleManager.onStatusChange((text, status) => {
                                const className = status === 'connected' ? 'status-ready' : (status === 'connecting' ? 'status-waiting' : 'status-disconnected');
                                window.updateSerialStatus(text, className);
                                // ë²„íŠ¼ ë¼ë²¨: BLE ì—°ê²° ì‹œ "ì—°ê²° í•´ì œ", í•´ì œ ì‹œ "ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°"
                                if (serialButton) {
                                    if (status === 'connected') {
                                        serialButton.textContent = 'ì—°ê²° í•´ì œ';
                                    } else if (status === 'connecting') {
                                        serialButton.textContent = 'ì—°ê²° ì¤‘...';
                                    } else {
                                        serialButton.textContent = 'ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°';
                                    }
                                }
                            });
                            // ì™¸ë¶€(ìŠ¤ì¼€ì¹˜)ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ê³µê°œ
                            window.bleManager = bleManager;
                        }

                        if (bleManager.isConnected()) {
                            await bleManager.disconnect();
                            if (serialButton) serialButton.textContent = 'ì—°ê²°';
                        } else {
                            await bleManager.connect();
                            if (serialButton) serialButton.textContent = 'ì—°ê²° í•´ì œ';
                        }
                    } catch (e) {
                        console.error(e);
                        alert('ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²° ì‹¤íŒ¨: ' + (e && e.message ? e.message : String(e)));
                    }
                } else {
                    if (window.isMobileDevice) {
                        alert('ëª¨ë°”ì¼ì—ì„œëŠ” ì‹œë¦¬ì–¼ ì—°ê²°ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸”ë£¨íˆ¬ìŠ¤ë¥¼ ì´ìš©í•˜ì„¸ìš”.');
                        return;
                    }
                    if (window.newConnect) {
                        window.newConnect();
                    }
                }
            });
        }

        // ì´ˆê¸° ìƒíƒœ ì„¤ì •
        window.currentDeviceMode = 'microbit';
        updateHeaderTitle(false);
        // ì´ˆê¸° í…Œë§ˆ ì„¤ì •
        try {
            document.body.classList.add('theme-microbit');
        } catch (e) {}
    </script>
    
    <script src="../ble/ble.js"></script>
    <script src="sketch.js"></script>
    <script>
        // ë°˜ì‘í˜•: ì„¤ì • ë°”ë¥¼ ì˜¤ë²„ë ˆì´ë¡œ ì´ë™/ë³µê·€
        (function() {
            const settingsBar = document.querySelector('.header-settings-bar');
            const overlayMount = document.getElementById('overlaySettingsMount');
            const mobileHint = document.querySelector('.mobile-hint');
            const headerToggleBtnEl = document.getElementById('headerToggleBtn');
            const headerEl = document.querySelector('.header');
            const containerEl = document.querySelector('.serial-connection .container');
            let placeholder = null;

            function isMobileWidth() {
                return window.matchMedia('(max-width: 900px)').matches;
            }

            function moveToOverlay() {
                if (!settingsBar || !overlayMount) return;
                if (!placeholder) {
                    placeholder = document.createElement('div');
                    placeholder.id = 'headerSettingsPlaceholder';
                    settingsBar.parentNode.insertBefore(placeholder, settingsBar);
                }
                overlayMount.appendChild(settingsBar);
                if (mobileHint) mobileHint.style.display = 'block';
                if (headerToggleBtnEl) headerToggleBtnEl.style.display = 'none';
            }

            function moveToDesktop() {
                if (!settingsBar || !placeholder || !placeholder.parentNode) return;
                placeholder.parentNode.insertBefore(settingsBar, placeholder);
                placeholder.remove();
                placeholder = null;
                if (mobileHint) mobileHint.style.display = 'none';
                if (headerToggleBtnEl) headerToggleBtnEl.style.display = '';
            }

            function applyLayout() {
                if (isMobileWidth()) {
                    // ì˜¤ë²„ë ˆì´ê°€ ì—´ë ¤ìˆìœ¼ë©´ ì„¤ì • ë°”ëŠ” ì´ë¯¸ ì˜¤ë²„ë ˆì´ì— ìˆì–´ì•¼ í•¨
                    moveToOverlay();
                    // ëª¨ë°”ì¼ì—ì„œ ì»¨í…Œì´ë„ˆ ìƒë‹¨ ì—¬ë°±: í—¤ë” ë†’ì´ + 30px
                    if (headerEl && containerEl) {
                        const headerRect = headerEl.getBoundingClientRect();
                        const topPadding = Math.max(0, headerRect.height + 30);
                        containerEl.style.paddingTop = topPadding + 'px';
                    }
                } else {
                    moveToDesktop();
                    // ì˜¤ë²„ë ˆì´ê°€ ì—´ë ¤ ìˆë‹¤ë©´ ë‹«ê¸°
                    const overlay = document.getElementById('navOverlay');
                    const btn = document.getElementById('hamburgerBtn');
                    if (overlay && overlay.classList.contains('open')) {
                        overlay.classList.remove('open');
                        if (btn) btn.classList.remove('open');
                        document.body.style.overflow = '';
                    }
                    // ë°ìŠ¤í¬í†± ê¸°ë³¸ íŒ¨ë”© ë³µê·€
                    if (containerEl) {
                        containerEl.style.paddingTop = '360px';
                    }
                }
            }

            window.addEventListener('resize', applyLayout);
            window.addEventListener('orientationchange', applyLayout);
            document.addEventListener('DOMContentLoaded', applyLayout);
            // ì´ˆê¸° ì ìš© (DOMContentLoaded ì´ì „ ì‹¤í–‰ ëŒ€ë¹„)
            applyLayout();
        })();
    </script>
</body>
</html>